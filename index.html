<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlgoTrust | University Governance</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Algorand SDK -->
    <script src="https://unpkg.com/algosdk@2.4.0/dist/browser/algosdk.min.js"></script>

    <!-- ✅ Updated Pera Wallet SDK (latest stable UMD build) -->
    <script src="https://unpkg.com/@perawallet/connect/dist/umd/index.min.js"></script>

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #fffaf5; 
            background-image: 
                radial-gradient(at 0% 0%, #fff7ed 0px, transparent 50%),
                radial-gradient(at 100% 100%, #ffedd5 0px, transparent 50%);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(0, 0, 0, 0.12);
            box-shadow: 0 40px 100px -20px rgba(234, 88, 12, 0.15), 0 20px 40px -15px rgba(0, 0, 0, 0.1);
            border-radius: 40px;
        }

        .orange-btn {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            transition: all 0.3s ease;
        }

        .orange-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px -5px rgba(234, 88, 12, 0.3);
        }

        .loader {
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-6 md:p-12">

<div class="max-w-6xl w-full grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">

    <!-- LEFT -->
    <div class="space-y-10 lg:pr-10">
        <div class="inline-flex items-center space-x-3 bg-white px-5 py-2 rounded-full border border-orange-100 shadow-sm">
            <span class="flex h-2.5 w-2.5 rounded-full bg-orange-500 animate-pulse"></span>
            <span class="text-xs font-bold tracking-widest text-orange-600 uppercase">RIFT 2026 Hackathon</span>
        </div>

        <div class="space-y-6">
            <h1 class="text-7xl font-extrabold text-stone-900 tracking-tighter leading-[1.05]">
                Campus <br/>
                <span class="text-orange-600">Governance.</span>
            </h1>

            <p class="text-xl text-stone-500 leading-relaxed max-w-lg">
                A decentralized hub for students to vote on proposals, fund campus initiatives, and settle club expenses—securely on Algorand.
            </p>
        </div>
    </div>

    <!-- RIGHT CARD -->
    <div class="glass-card p-10 md:p-14 relative overflow-hidden">
        <div class="relative z-10">

            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-stone-800">Student Portal</h2>
                <p class="text-stone-500 mt-2">Connect your wallet to access the hub</p>
            </div>

            <div id="wallet-status" class="hidden mb-10 p-6 bg-orange-50 rounded-3xl border border-orange-200">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-bold text-orange-600 uppercase">Verified Student Account</span>
                    <button id="disconnect-btn" class="text-xs text-red-500 underline font-bold uppercase">Sign Out</button>
                </div>
                <p id="account-address" class="text-sm font-mono truncate font-semibold"></p>
            </div>

            <div class="space-y-5">
                <button id="connect-btn" class="orange-btn w-full py-5 text-white font-bold rounded-[24px] flex items-center justify-center space-x-3 text-lg">
                    <span id="btn-text">Connect Pera Wallet</span>
                    <div id="btn-loader" class="hidden w-5 h-5 border-2 border-white rounded-full loader"></div>
                </button>

                <a id="enter-dashboard" href="frontend/dashboard.html"
                   class="hidden w-full py-5 bg-stone-900 text-white rounded-[24px] font-bold text-center block text-lg">
                    Enter Dashboard
                </a>
            </div>
        </div>
    </div>
</div>

<script>
let peraWallet = null;

const connectBtn = document.getElementById('connect-btn');
const disconnectBtn = document.getElementById('disconnect-btn');
const btnText = document.getElementById('btn-text');
const btnLoader = document.getElementById('btn-loader');
const enterBtn = document.getElementById('enter-dashboard');
const statusPanel = document.getElementById('wallet-status');
const addressText = document.getElementById('account-address');

window.addEventListener("load", async () => {

    if (!window.PeraWalletConnect) {
        console.error("Pera Wallet SDK not loaded");
        return;
    }

    peraWallet = new window.PeraWalletConnect({
        shouldShowSignTxnToast: false
    });

    try {
        const accounts = await peraWallet.reconnectSession();
        if (accounts.length) updateUI(accounts[0]);

        peraWallet.connector?.on("disconnect", handleDisconnect);

    } catch {
        console.log("No previous session");
    }
});

connectBtn.addEventListener("click", connectWallet);
disconnectBtn.addEventListener("click", disconnectWallet);

async function connectWallet() {
    if (!peraWallet) return;

    setLoading(true);

    try {
        const accounts = await peraWallet.connect();
        if (accounts.length) updateUI(accounts[0]);

        peraWallet.connector?.on("disconnect", handleDisconnect);

    } catch (error) {
        if (error?.data?.type !== "CONNECT_MODAL_CLOSED") {
            alert("Connection failed. Make sure Pera Wallet is installed.");
        }
    }

    setLoading(false);
}

async function disconnectWallet() {
    if (!peraWallet) return;
    await peraWallet.disconnect();
    handleDisconnect();
}

function updateUI(address) {
    addressText.innerText = address;
    localStorage.setItem("walletAddress", address);

    statusPanel.classList.remove("hidden");
    connectBtn.classList.add("hidden");
    enterBtn.classList.remove("hidden");
}

function handleDisconnect() {
    localStorage.removeItem("walletAddress");

    statusPanel.classList.add("hidden");
    connectBtn.classList.remove("hidden");
    enterBtn.classList.add("hidden");

    btnText.innerText = "Connect Pera Wallet";
}

function setLoading(state) {
    btnLoader.classList.toggle("hidden", !state);
    connectBtn.disabled = state;
    btnText.innerText = state ? "Checking Pera..." : "Connect Pera Wallet";
}
</script>

</body>
</html>
